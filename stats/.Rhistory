pref_slope_different_speaker = child_model_param$pref_slope_different_speaker,
pref_int_same_speaker = child_model_param$pref_int_same_speaker,
pref_slope_same_speaker = child_model_param$pref_slope_same_speaker,
so = so_int+so_slope*(age_num-min(age_num)),
diff_prior = plogis(pref_int_different_speaker+pref_slope_different_speaker*(age_num-min(age_num))),
same_prior = plogis(pref_int_same_speaker+pref_slope_same_speaker*(age_num-min(age_num))))%>%
group_by(id,trial)%>%
mutate(priorProbs = ifelse(speaker == "same_speaker" & alignment == "congruent", list(c(1-same_prior,1-same_prior,same_prior)),
ifelse(speaker == "different_speaker" & alignment == "congruent", list(c(1-diff_prior,1-diff_prior,diff_prior)),
ifelse(speaker == "same_speaker" & alignment == "incongruent", list(c(same_prior,same_prior,1-same_prior)),
list(c(diff_prior,diff_prior,1-diff_prior))
))))%>%
ungroup()%>%
select(speaker,age_num,minage,alignment,so,priorProbs,correct_inf)
child.ex3.rsa.predictions <-'
var allData = dataFromR.ex3data
var output = map(function(row){
var modelPredictions = pragmaticListener({label: "dax", point: 2 }, row.priorProbs,row.so)
return extend([row.age_num + "/" + row.speaker + "/" + row.alignment + "/" + row.correct_inf, Math.exp(modelPredictions.score(1))])
}, allData)
output
'
child_ex3_pragm_model<- webppl(
program_code = paste(rsaUtils, rsaModel, child.ex3.rsa.predictions , sep='\n'),
data =list(ex3data = ex3_model_data),
data_var = "dataFromR"
)
# model predictions
child_ex3_pragm_model_predictions <- child_ex3_pragm_model %>%
separate(`0`, into = c("age", "speaker", "alignment","correct"), sep="/")%>%
mutate(value = `1`,
model="pragmatic",
age = as.numeric(age))%>%
select(-`1`)
child.ex3.prior.only.predictions <-'
var allData = dataFromR.ex3data
var output = map(function(row){
var modelPredictions = Infer({method: "enumerate", model: function(){
var obj = sample( Categorical({vs: all_objects, ps: row.priorProbs}));
return obj.shape == "circle" ? 1 : 0
}})
return  extend([row.age_num + "/" + row.speaker + "/" + row.alignment+ "/" + row.correct_inf, Math.exp(modelPredictions.score(1))])
}, allData)
output
'
child_ex3_prior_only_model<- webppl(
program_code = paste(rsaUtils, rsaModel, child.ex3.prior.only.predictions , sep='\n'),
data =list(ex3data = ex3_model_data),
data_var = "dataFromR"
)
# model predictions
child_ex3_prior_only_model_predictions <- child_ex3_prior_only_model %>%
separate(`0`, into = c("age", "speaker", "alignment","correct"), sep="/")%>%
mutate(value = `1`,
model="prior_only",
age = as.numeric(age))%>%
select(-`1`)
child.ex3.flat.prior.predictions <-'
var allData = dataFromR.ex3data
var output = map(function(row){
var prior = [.5, .5, .5]
var modelPredictions = pragmaticListener({label: "dax", point: 2 }, prior,row.so)
return  extend([row.age_num + "/" + row.speaker + "/" + row.alignment + "/" + row.correct_inf, Math.exp(modelPredictions.score(1))])
}, allData)
output
'
child_ex3_flat_prior_model<- webppl(
program_code = paste(rsaUtils, rsaModel, child.ex3.flat.prior.predictions , sep='\n'),
data =list(ex3data = ex3_model_data),
data_var = "dataFromR")
# model predictions
child_ex3_flat_prior_model_predictions <- child_ex3_flat_prior_model %>%
separate(`0`, into = c("age", "speaker", "alignment","correct"), sep="/")%>%
mutate(value = `1`,
model="flat_prior",
age = as.numeric(age))%>%
select(-`1`)
child_model_predictions <- bind_rows(
child_ex3_pragm_model_predictions,
child_ex3_flat_prior_model_predictions,
child_ex3_prior_only_model_predictions
)
plot_child_ex3_data <- child_ex3_data%>%
group_by(age_num,speaker,alignment)%>%
summarise(mean = mean(correct_inf))
ggplot(child_model_predictions)+
#geom_jitter(data = plot_child_ex3_data, aes(x = age_num, y = mean), width = .025,height = .025, alpha = .2)+
geom_line(aes(x = age, y = value, col = model), size = 1, alpha = 1, linetype = 1) +
geom_smooth(data = child_ex3_data, aes(x = age_num, y = correct_inf), col = "black", size = 0.6, method = "loess", span = 1,  se = T,  alpha = .5)+
#geom_hline(yintercept = 0.5, lty=2)+
labs(y="proportion more informative")+
ylim(-0.05,1.05)+
facet_grid(speaker~alignment)+
theme_few()+
scale_color_manual(name="Model",
breaks=c("pragmatic","flat_prior","prior_only"),
values= c("#859900","#6c71c4","#b58900"))+
scale_fill_manual(name="Model",
breaks=c("pragmatic","flat_prior","prior_only"),
values= c("#859900","#6c71c4","#b58900"))
child_cor_data <- child_ex3_data %>%
filter(trial != "filler1",
trial != "filler2")%>%
group_by(speaker, alignment, age_bin) %>%
summarize(k = sum(correct_inf), n = n())%>%
ungroup() %>%
mutate(a = 1 + k,
b = 1 + n - k,
Data_ci_lower  = qbeta(.025, a, b),
Data_ci_upper = qbeta(.975, a, b),
Data = (a-1)/(a+b-2))%>%
select(-a,-b,-n,-k)
child_cor_model <- child_model_predictions %>%
mutate(age = ifelse(age<4,"3","4"))%>%
group_by(model,speaker,alignment, age)%>%
summarise(Model = mean(value))
child_cor_plot <- child_cor_model %>%
ungroup()%>%
mutate(Data = rep(child_cor_data$Data,3),
Data_ci_lower = rep(child_cor_data$Data_ci_lower,3),
Data_ci_upper  =rep( child_cor_data$Data_ci_upper,3))
ggplot(data = child_cor_plot,aes(x = Model, y = Data, col = age)) +
geom_abline(intercept = 0, slope = 1, lty = 2, alpha = 1, size = .5)+
geom_point(size = 3)+
geom_errorbar(aes(ymin = Data_ci_lower, ymax = Data_ci_upper),width = 0,size = .5)+
coord_fixed()+
facet_grid(~model)+
stat_cor(method = "pearson", label.x = 0.01, label.y = 0.99, aes(x = Model, y = Data), inherit.aes = F)+
xlim(0,1)+ylim(0,1)+
xlab("Model")+
theme_few() +
scale_colour_ptol()
# calculating model log-likelihoods
log_like_pragmatic <- child_ex3_pragm_model_predictions %>%
mutate(like = ifelse(correct == "1",value,1-value),
log_like = log(like))%>%
group_by(model)%>%
summarise(model_log_like = sum(log_like))
log_like_flat_prior <- child_ex3_flat_prior_model_predictions %>%
mutate(like = ifelse(correct == "1",value,1-value),
log_like = log(like))%>%
group_by(model)%>%
summarise(model_log_like = sum(log_like))
log_like_prior_only <- child_ex3_prior_only_model_predictions %>%
mutate(like = ifelse(correct == "1",value,1-value),
log_like = log(like))%>%
group_by(model)%>%
summarise(model_log_like = sum(log_like))
child_ex3_model_comparison <- bind_rows(
log_like_pragmatic,
log_like_flat_prior,
log_like_prior_only
)%>%
mutate(model = reorder(model,model_log_like))
ggplot(child_ex3_model_comparison, aes(x = model, y = model_log_like, col = model))+
geom_segment( aes(x=model, xend=model, y=-425, yend=model_log_like), col = "black", size = 1)+
geom_point(size = 7)+
theme_few()+
xlab("Model")+
ylab("Log-likelihood")+
theme(axis.text.x=element_text(angle = 45, vjust = 1, hjust = 1))+
guides(col = F)+
ylim(-550,-425)+
scale_color_manual(breaks=c("pragmatic","prior_only","flat_prior"),
values= c("#b58900","#859900","#6c71c4"))
child_ex3_bf <- data.frame(
comparison = c("pragmatic vs. flat_prior","pragmatic vs. prior_only", "flat_rior vs. prior_only"),
log_bayes_factor = c(
log_like_pragmatic$model_log_like - log_like_flat_prior$model_log_like,
log_like_pragmatic$model_log_like- log_like_prior_only$model_log_like,
log_like_flat_prior$model_log_like - log_like_prior_only$model_log_like)
)
child_ex3_bf%>%
kable(digits = 2)
# load packages and functions
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(ggthemes)
library(langcog)
library(rwebppl)
library(matrixStats)
library(coda)
library(ggpubr)
estimate_mode <- function(s) {
d <- density(s)
return(d$x[which.max(d$y)])
}
hdi_upper<- function(s){
m <- HPDinterval(mcmc(s))
return(m["var1","upper"])
}
hdi_lower<- function(s){
m <- HPDinterval(mcmc(s))
return(m["var1","lower"])
}
child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct, col = condition)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
facet_wrap( ~ experiment, labeller = as_labeller(c(`child_ex2`="Exp. 2", `child_ex1`="Exp. 1")))+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)+
scale_color_solarized(name = "Condition")+
scale_fill_solarized(name = "Condition")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(ggthemes)
library(langcog)
library(rwebppl)
library(coda)
library(ggpubr)
estimate_mode <- function(s) {
d <- density(s)
return(d$x[which.max(d$y)])
}
hdi_upper<- function(s){
m <- HPDinterval(mcmc(s))
return(m["var1","upper"])
}
hdi_lower<- function(s){
m <- HPDinterval(mcmc(s))
return(m["var1","lower"])
}
# children ex3 data
child_ex3_data <-read_csv(file="../../stats/data/child_ex3.csv")
# load data from ex1 manipulation experiments to set speaker optimality parameter
child_ex1_data <-read_csv(file="../../stats/data/child_ex1.csv")
# load data from ex2 experiment to set priors
child_ex2_data <-read_csv(file="../../stats/data/child_ex2.csv")
# child_model_param<- webppl(
#   program_code = paste(rsaUtils, rsaModel, childModelParam , sep='\n'),
#   data = list(prefData = child_ex2_data, infData = child_ex1_data),
#   data_var = "dataFromR",
#   model_var = "model",
#   chains = 4,
#   cores = 4,
#   inference_opts = list(method = "MCMC", samples = 7000, burn = 1000, verbose = T)
# )%>%
#   saveRDS("../../stats/saves/child_model_param.rds")
child_model_param <- readRDS("../../stats/saves/child_model_param.rds")%>%
select(value) %>%
map_df(bind_rows)%>%
group_by(param,condition)%>%
summarise(param_map = estimate_mode(val))%>%
mutate(cond = paste(param,condition, sep = "_"))%>%
ungroup()%>%
select(cond,param_map)%>%
spread(cond,param_map)%>%
rename(so_int = so_int_NA,
so_slope = so_slope_NA)
# visualize inferred parameter
plot_child_model_param <- readRDS("../../stats/saves/child_model_param.rds")%>%
select(value)%>%
map_df(bind_rows)%>%
mutate(type = ifelse(grepl("pref",param),"prior", "speaker optimality"))
ggplot(plot_child_model_param, aes(val))+
geom_density()+
xlab("Parameter")+
facet_grid(type~param+condition)+
theme_few()
# visualize model priors in comparison to data
child_prior_plot <- child_ex2_data %>%
group_by(id,age_num,minage,condition)%>%
summarise(correct = mean(correct))%>%
mutate(model = ifelse(condition == "different_speaker",
plogis(child_model_param$pref_int_different_speaker + child_model_param$pref_slope_different_speaker * (age_num-minage)),
plogis(child_model_param$pref_int_same_speaker + child_model_param$pref_slope_same_speaker * (age_num-minage)
)))
ggplot(data = child_prior_plot, aes(x = age_num, y = correct, col = condition)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_line(aes(x = age_num, y = model, col = condition), size = 1.5, lty = 2)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)+
scale_color_solarized(name = "Condition")+
scale_fill_solarized(name = "Condition")
ggplot(data = p_figx, aes(x = age_num, y = correct, col = condition)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
facet_wrap( ~ experiment, labeller = as_labeller(c(`child_ex2`="Exp. 2", `child_ex1`="Exp. 1")))+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)+
scale_color_solarized(name = "Condition")+
scale_fill_solarized(name = "Condition")
p_figx <- bind_rows(child_ex1_data%>%
mutate(condition = "test"),
child_ex2_data %>%
mutate(condition = ifelse(condition == "same_speaker","test", "control"))) %>%
mutate(experiment = factor(experiment),
condition = factor(condition, levels = c("test","control")))%>%
group_by(experiment,condition,age_num, id) %>%
summarise(correct = mean(correct))
ggplot(data = p_figx, aes(x = age_num, y = correct, col = condition)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
facet_wrap( ~ experiment, labeller = as_labeller(c(`child_ex2`="Exp. 2", `child_ex1`="Exp. 1")))+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)+
scale_color_solarized(name = "Condition")+
scale_fill_solarized(name = "Condition")
child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct, col = condition)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
facet_wrap( ~ experiment, labeller = as_labeller(c(`child_ex2`="Exp. 2", `child_ex1`="Exp. 1")))+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)+
scale_color_solarized(name = "Condition")+
scale_fill_solarized(name = "Condition")
child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct, col = condition)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
child_ex1_data %>%
group_by(condition,age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct, col = condition)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
child_ex1_data
child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(aes(fill = condition),method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
# visualize speaker optimality in comparison to data
child_so_plot <- child_ex1_data %>%
group_by(id,age_num,minage)%>%
summarise(correct = mean(correct))%>%
mutate(model = child_model_param$so_int + child_model_param$so_slope * (age_num - minage))
plot_child_so <- ggplot(data = child_so_plot, aes(x = age_num, y = model)) +
geom_line(alpha = .5, size = .7)+
labs(x="Age",y="Speaker optimality parameter")+
theme_few() +
ggtitle("Speaker optimality parameter")+
geom_hline(yintercept = 0, lty=2)+
ylim(-3,3)+
guides(alpha = F)
plot_ex1_child <-child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
ggtitle("Data ex1 children")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
ggarrange(plot_child_so,plot_ex1_child)
child_ex1_data
length(unique(child_ex1_data$id))
# visualize speaker optimality in comparison to data
child_so_plot <- child_ex1_data %>%
group_by(id,age_num,minage)%>%
summarise(correct = mean(correct))%>%
mutate(model = child_model_param$so_int + child_model_param$so_slope * (age_num - minage))
plot_child_so <- ggplot(data = child_so_plot, aes(x = age_num, y = model)) +
geom_line(alpha = .5, size = .7)+
labs(x="Age",y="Speaker optimality parameter")+
theme_few() +
ggtitle("Speaker optimality parameter")+
geom_hline(yintercept = 0, lty=2)+
ylim(-3,3)+
guides(alpha = F)
plot_ex1_child <-child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
ggtitle("Data ex1 children")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
ggarrange(plot_child_so,plot_ex1_child)
plot_child_so <- ggplot(data = child_so_plot, aes(x = age_num, y = model)) +
geom_line(alpha = .5, size = 2)+
labs(x="Age",y="Speaker optimality parameter")+
theme_few() +
ggtitle("Speaker optimality parameter")+
geom_hline(yintercept = 0, lty=2)+
ylim(-3,3)+
guides(alpha = F)
# visualize speaker optimality in comparison to data
child_so_plot <- child_ex1_data %>%
group_by(id,age_num,minage)%>%
summarise(correct = mean(correct))%>%
mutate(model = child_model_param$so_int + child_model_param$so_slope * (age_num - minage))
plot_child_so <- ggplot(data = child_so_plot, aes(x = age_num, y = model)) +
geom_line(alpha = .5, size = 2)+
labs(x="Age",y="Speaker optimality parameter")+
theme_few() +
ggtitle("Speaker optimality parameter")+
geom_hline(yintercept = 0, lty=2)+
ylim(-3,3)+
guides(alpha = F)
plot_ex1_child <-child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
ggtitle("Data ex1 children")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
ggarrange(plot_child_so,plot_ex1_child)
plot_child_so <- ggplot(data = child_so_plot, aes(x = age_num, y = model)) +
geom_hline(yintercept = 0, lty=2)+
geom_line(alpha = .5, size = 2)+
labs(x="Age",y="Speaker optimality parameter")+
theme_few() +
ggtitle("Speaker optimality parameter")+
ylim(-3,3)+
guides(alpha = F)
plot_ex1_child <-child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
ggtitle("Data ex1 children")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
ggarrange(plot_child_so,plot_ex1_child)
plot_child_so <- ggplot(data = child_so_plot, aes(x = age_num, y = model)) +
geom_hline(yintercept = 0, lty=2)+
geom_line( size = 2)+
labs(x="Age",y="Speaker optimality parameter")+
theme_few() +
ggtitle("Speaker optimality parameter")+
ylim(-3,3)+
guides(alpha = F)
plot_ex1_child <-child_ex1_data %>%
group_by(age_num, id) %>%
summarise(correct = mean(correct))%>%
ggplot(data = ., aes(x = age_num, y = correct)) +
geom_jitter(alpha = 0.5, height = 0.02, width = 0)+
geom_smooth(method = "lm", se = T, alpha = .5, size = .7)+
geom_hline(yintercept = 0.5, lty=2)+
labs(x="Age",y="Proportion Correct")+
ggtitle("Data ex1 children")+
theme_few() +
ylim(-0.05,1.05)+
guides(alpha = F)
ggarrange(plot_child_so,plot_ex1_child)
child_ex3_bf <- data.frame(
comparison = c("pragmatic vs. flat_prior","pragmatic vs. prior_only", "flat_rior vs. prior_only"),
log_bayes_factor = c(
log_like_pragmatic$model_log_like - log_like_flat_prior$model_log_like,
log_like_pragmatic$model_log_like- log_like_prior_only$model_log_like,
log_like_flat_prior$model_log_like - log_like_prior_only$model_log_like)
)
