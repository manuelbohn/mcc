---
title: "MCC Ex3 Preference Kids"
author: "Manuel Bohn"
output: html_document
---

```{r import data, include = F}
###
library(tidyverse)
library(knitr)
library(langcog)
library(ggthemes)
library(jsonlite)
library(readxl)

## importing data
files <- dir("~/Work/MCC/git-mcc/kids_EX3/pref/")

raw_data <- data_frame()
for (f in files) {
  jf <- paste("~/Work/MCC/git-mcc/kids_EX3/pref/",f,sep="")
  jd <- jsonlite::fromJSON(paste(readLines(jf), collapse=""))
  date <- str_sub(jf,45,str_length(jf)-11)
  id <- as_data_frame(jd$data$data) %>% mutate(test_date = date)
  raw_data <- bind_rows(raw_data, id)
}

d_raw <-raw_data
 
d_raw



```

# Sample size per age bin

```{r kids per age group,echo = F }

d %>%
  group_by(subage)%>%
  summarise(n = length(unique(subid)))%>%
  knitr::kable(digits = 2)

```

# Plot filler by age

```{r plot by age, echo= FALSE}
pf1 <- d %>%
      filter(trial == "filler1" | trial == "filler2")%>%
  group_by(control,subage, subid) %>%
  summarise(correct = mean(correct)) 

pf2 <- pf1 %>%
  multi_boot_standard(col = "correct")


ggplot() +
  geom_jitter(data = pf1, aes(x = control, y = correct, col = control, alpha = .2),width = .3,height = .025)+
  geom_pointrange(data = pf2, aes(x = control, y = mean, col = control, ymin = ci_lower, ymax = ci_upper),size = .8)+
  geom_hline(yintercept = 0.5, lty=2)+
  labs(x="",y="Proportion Expected Choice")+
  theme_few() +
  facet_wrap(~subage)+
  ylim(-0.05,1.05)+
  guides(alpha = F)+ 
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank())+
  scale_colour_solarized(name="Control",
                     breaks=c("false", "true"),
                     labels=c("No", "Yes"))
```



# Plot by age group

```{r plot by age, echo= FALSE}

p1 <- d %>%
  filter(trial != "filler1",
         trial != "filler2")%>%
  group_by(control,subage, subid) %>%
  summarise(correct = mean(correct)) 

p2 <- p1 %>%
  multi_boot_standard(col = "correct")


ggplot() +
  geom_jitter(data = p1, aes(x = control, y = correct, col = control, alpha = .2),width = .3,height = .025)+
  geom_pointrange(data = p2, aes(x = control, y = mean, col = control, ymin = ci_lower, ymax = ci_upper),size = .8)+
  geom_hline(yintercept = 0.5, lty=2)+
  labs(x="",y="Proportion Expected Choice")+
  theme_few() +
  facet_wrap(~subage)+
  ylim(-0.05,1.05)+
  guides(alpha = F)+ 
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank())+
  scale_colour_solarized(name="Control",
                     breaks=c("false", "true"),
                     labels=c("No", "Yes"))
```

# Plot overall test

```{r plot across age, echo = F }
p3 <- d %>%
  filter(trial != "filler1",
  trial != "filler2")%>%
  group_by(control, subid) %>%
  summarise(correct = mean(correct)) 

p4 <- p3 %>%
  multi_boot_standard(col = "correct")

ggplot() +
  geom_jitter(data = p3, aes(x = control, y = correct, col = control, alpha = .2),width = .3,height = .025)+
  geom_pointrange(data = p4, aes(x = control, y = mean, col = control, ymin = ci_lower, ymax = ci_upper),size = .8)+
  geom_hline(yintercept = 0.5, lty=2)+
  labs(x="",y="Proportion Expected Choice")+
  theme_few() +
  ylim(-0.05,1.05)+
  guides(alpha = F)+ 
  theme(axis.text.x=element_blank(),axis.ticks.x=element_blank())+
  scale_colour_solarized(name="Control",
                     breaks=c("false", "true"),
                     labels=c("No", "Yes"))

```




